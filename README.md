# GIAB Test: BED/BAM Coverage Analysis Tool

Calculates coverage metrics from BED and BAM files using mosdepth. This tool processes genomic data to provide insights into sequence coverage across specified regions.

## Requirements

*   **Python:** 3.10 or later
*   **Poetry:** For managing Python dependencies (see [Poetry installation guide](https://python-poetry.org/docs/#installation))
*   **mosdepth:** 0.3.11 or later (External tool, see installation below)
*   **pysam:** Python library (installed via Poetry)

## Installation

1.  **Install mosdepth:**
    Follow the instructions on the official mosdepth repository:
    [https://github.com/brentp/mosdepth](https://github.com/brentp/mosdepth)

2.  **Clone this repository:**
    ```bash
    git clone <repository_url> # Replace <repository_url> with the actual URL
    cd giab-test
    ```

3.  **Install Python dependencies using Poetry:**
    ```bash
    poetry install
    ```

## Usage

Run the analysis script using Poetry:

```bash
poetry run python src/main.py --bed Bed_and_Bam_file/test_fixed.bed \
                             --bam Bed_and_Bam_file/RMNISTHS_30xdownsample.bam \
                             --output-prefix test_output
```

### Options

*   `--bed`: Input BED file path. (Default: `Bed_and_Bam_file/test_fixed.bed`)
*   `--bam`: Input BAM file path. (Required)
*   `--output-prefix`: Prefix for output file names. (Required)
*   `--full-bed`: Use the full Twist Exome Core Covered Targets BED file (`Bed_and_Bam_file/Twist_Exome_Core_Covered_Targets_hg38_fixed.bed`).
*   `--keep-intermediates`: Keep intermediate files generated by mosdepth instead of deleting them.

## Output Files

*   **Coverage Results:** `Result_cov_file/<output-prefix>.coverage.bed`
    *   Contains the final coverage metrics per region defined in the input BED file.
*   **Intermediate Files (Optional):** `Intermediate_Files/<output-prefix>.*`
    *   Temporary files generated by `mosdepth` (e.g., `.mosdepth.global.dist.txt`, `.mosdepth.region.dist.txt`, `.regions.bed.gz`). These are removed by default unless `--keep-intermediates` is specified.

## Example Output

```
Validating input files...
Running mosdepth on Bed_and_Bam_file/RMNISTHS_30xdownsample.bam using regions from Bed_and_Bam_file/test_fixed.bed...
Processing coverage data from Intermediate_Files/test_output.regions.bed.gz...
Successfully created coverage file at Result_cov_file/test_output.coverage.bed
```

## Data Sources
BAM:  
https://ftp.ncbi.nlm.nih.gov/ReferenceSamples/giab/data/NA12878/NIST_NA12878_HG001_HiSeq_300x/

BED:  
https://www.twistbioscience.com/resources/data-files/ngs-human-core-exome-panel-bed-file
